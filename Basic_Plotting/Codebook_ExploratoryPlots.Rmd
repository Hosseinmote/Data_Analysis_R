---
title: "R Notebook"
author: "Mohammad H. Motevaselian"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    df_print: paged
  pdf_document: default
---

# Project 1: Base Plots in R

### Goal: Analyze data and make some exploratory plots using R base plotting system

### Download and unzip data to /dataset directory

```{r}
filepath <- "/Users/Mohammad/Research/Coursera/Data_Analysis_R"

setwd(filepath)

if(!file.exists("./dataset")) {dir.create("./dataset")}

fileUrl <- "https://d396qusza40orc.cloudfront.net/exdata%2Fdata%2Fhousehold_power_consumption.zip"

download.file(fileUrl,destfile="./dataset/Household_Power_Consumption_UCIrvineML.zip",method="curl")

unzip(zipfile="./dataset/Household_Power_Consumption_UCIrvineML.zip",exdir="./dataset")
```

## Description of the data

The data is from the UC Irvine Machine Learning Repository. In particular, we will be using the “Individual household electric power consumption Data Set” generated by Roger D. Peng during a coursera course of "Exploratory data analysis with R".

The data include measurements of electric power consumption in one household with a one-minute sampling rate over a period of almost 4 years. Different electrical quantities and some sub-metering values are available.

The following descriptions of the 9 variables in the dataset are taken from the UCI web site:

1. Date: Date in format dd/mm/yyyy
2. Time: time in format hh:mm:ss
3. Global_active_power: household global minute-averaged active power (in kilowatt)
4. Global_reactive_power: household global minute-averaged reactive power (in kilowatt)
5. Voltage: minute-averaged voltage (in volt)
6. Global_intensity: household global minute-averaged current intensity (in ampere)
7. Sub_metering_1: energy sub-metering No. 1 (in watt-hour of active energy). It corresponds to the kitchen, containing mainly a dishwasher, an oven and a microwave (hot plates are not electric but gas powered).
8. Sub_metering_2: energy sub-metering No. 2 (in watt-hour of active energy). It corresponds to the laundry room, containing a washing-machine, a tumble-drier, a refrigerator and a light.
9. Sub_metering_3: energy sub-metering No. 3 (in watt-hour of active energy). It corresponds to an electric water-heater and an air-conditioner.

### Rough estimate memomry allocation

The dataset has 2,075,259 rows and 9 columns. Therefore, 

2,075,259 $\times$ 9 $\times$ 8 bytes/numeric $=$ 149,418,64 bytes

149,418,64 / $2^{20}$ bytes/MB $\approx$ 142 MB, and we are OK !

### Loading and subsetting the data
```{r echo=FALSE, message=FALSE, warning=FALSE}
data <- read.table("./dataset/household_power_consumption.txt",sep=';',header=TRUE,stringsAsFactors=FALSE,na.strings = '?')
#Using data from the dates 2007-02-01 and 2007-02-02 :
selectedData <- data[data$Date %in% c("1/2/2007","2/2/2007"),] 
```
### Generating the basic plots 
### * Histogram 
```{r message=FALSE, warning=FALSE, paged.print=TRUE, dpi=36, out.width="600px", out.height="600px"}
global_active_power <- selectedData$Global_active_power
hist(global_active_power ,main="Global Active Power",xlab="Global Active Power (kilowatts)",col = 'red')
invisible(dev.copy(png,file="dataset/plot1.png"))
invisible(dev.off())
```
### * Plot
```{r message=FALSE, warning=FALSE, dpi=36, out.width="600px", out.height="600px"}
library(lubridate)
times <- strptime(paste(selectedData$Date,selectedData$Time),format="%d/%m/%Y %H:%M:%S")

plot(times,global_active_power,type='l',xlab=" ",ylab="Global Active Power (kilowatts)")  
invisible(dev.copy(png,file="dataset/plot2.png"))
invisible(dev.off())
```
### * Overlaying Multiple Plots
```{r, dpi=36, out.width="600px", out.height="600px"}
submeter1 <- selectedData$Sub_metering_1
submeter2 <- selectedData$Sub_metering_2
submeter3 <- selectedData$Sub_metering_3

plot(times, submeter1, type="l", ylab="Energy Submetering")
lines(times, submeter2, type="l", col="red")
lines(times, submeter3, type="l", col="blue")
legend("topright", c("Sub_metering_1", "Sub_metering_2", "Sub_metering_3"), lty=1, lwd=2.5, col=c("black", "red", "blue"))
invisible(dev.copy(png,file="dataset/plot3.png"))
invisible(dev.off())
```
### * Subplots in R
```{r, dpi=36, out.width="600px", out.height="600px"}
voltage <- selectedData$Voltage
global_reactive_power <- selectedData$Global_reactive_power
par(mfrow = c(2, 2)) 
# Top left
plot(times, global_active_power, type="l", xlab="", ylab="Global Active Power", cex=0.1)
# Top right
plot(times, voltage, type="l", xlab="datetime", ylab="Voltage")
# Bottom left
plot(times, submeter1, type="l", ylab="Energy Submetering")
lines(times, submeter2, type="l", col="red")
lines(times, submeter3, type="l", col="blue")
legend("topright", c("Sub_metering_1", "Sub_metering_2", "Sub_metering_3"), lty=1, lwd=2.5, col=c("black", "red", "blue"))
#Bottom right
plot(times, global_reactive_power, type="l", ylab="Global_Reactive_Power")

invisible(dev.copy(png,file="dataset/plot4.png"))
invisible(dev.off())
```

<!-- ways to check if there are any Nas in the data set -->
<!-- sapply(data, function(x) sum(is.na(x))) -->
<!-- sapply(data,function(x) any(grepl("NA",x))) -->
<!-- any(is.na(data)) -->

